# TODO: add hiera items:
# - contrail log path regex
# - contrail su

/var/log/containers/contrail/*log /var/log/containers/contrail/*err {
  su root root
  <%= @rotation %>
  rotate <%= @rotate %>
  maxage <%= @purge_after_days %>
  # minsize 1 is required for GDPR compliance, all files in
  # /var/log/containers not managed with logrotate will be purged!
  minsize 1
  # Do not use size as it's not compatible with time-based rotation rules
  # required for GDPR compliance.
  maxsize <%= @maxsize %>
  missingok
  notifempty
<%- if @copytruncate %>
  copytruncate
<%- end %>
<%- if @delaycompress %>
  delaycompress
<%- end %>
<%- if @compress %>
  compress
<%- end %>
<%- if @dateext %>
  dateext
<%- if @dateformat %>
  dateformat <%= @dateformat %>
<%- end %>
<%- if @dateyesterday %>
  dateyesterday
<%- end %>
<%- end %>
}

/var/log/containers/*/*log /var/log/containers/*/*/*log /var/log/containers/*/*err {
  <%= @rotation %>
  rotate <%= @rotate %>
  maxage <%= @purge_after_days %>
  # minsize 1 is required for GDPR compliance, all files in
  # /var/log/containers not managed with logrotate will be purged!
  minsize 1
  # Do not use size as it's not compatible with time-based rotation rules
  # required for GDPR compliance.
  maxsize <%= @maxsize %>
  missingok
  notifempty
<%- if @copytruncate %>
  copytruncate
<%- end %>
<%- if @delaycompress %>
  delaycompress
<%- end %>
<%- if @compress %>
  compress
<%- end %>
<%- if @dateext %>
  dateext
<%- if @dateformat %>
  dateformat <%= @dateformat %>
<%- end %>
<%- if @dateyesterday %>
  dateyesterday
<%- end %>
<%- end %>
}
